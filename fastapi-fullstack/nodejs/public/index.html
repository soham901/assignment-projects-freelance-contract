<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />

    <title>Document</title>
  </head>
  <body>
    <div class="container my-4">
      <h1 class="fw-bold" id="title">Leads</h1>

      <table class="table table-striped table-bordered" id="data-table">
        <thead class="thead-dark">
          <tr>
            <th scope="col">#</th>
            <th scope="col">First name</th>
            <th scope="col">Last name</th>
            <th scope="col">Phone Work</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="spinner">
        <div class="spinner-border" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>
    </div>

    <script src="libs/jquery-3.7.1.min.js"></script>
    <script src="libs/fontawesome-free-6.5.1-web/js/all.min.js"></script>
    <script src="libs/bstable.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <script>
      function handleEdit(e) {
        console.log("onEdit", e);

        const id = $(e).find("td").eq(0).text();
        const first_name = $(e).find("td").eq(1).text();
        const last_name = $(e).find("td").eq(2).text();
        const phone_work = $(e).find("td").eq(3).text();

        console.log(id, first_name, last_name, phone_work);

        // send the data to the server
        $.ajax({
          url: "/leads",
          type: "PUT",
          data: {
            id,
            first_name,
            last_name,
            phone_work,
          },
          success: function (data) {
            console.log(data);
          },
        });
      }

      function handleDelete(e) {
        console.log("onDelete", e);

        const id = $(e).find("td").eq(0).text();

        console.log(id);

        // send the request to the server
        $.ajax({
          url: "/leads",
          type: "DELETE",
          data: {
            id,
          },
          success: function (data) {
            console.log(data);
          },
        });

        // remove the row from the table
        // $(e).remove();
      }

      var editableTable = new BSTable("data-table", {
        editableColumns: "1,2,3",
        onEdit: handleEdit,
        onBeforeDelete: handleDelete,
      });
      editableTable.init();

      // add data from api
      $.ajax({
        url: "/leads",
        type: "GET",
        success: function (data) {
          // update the count of data on title
          $("#title").text(`Leads (${data.length || 0})`);

          data.forEach((lead) => {
            $("#data-table tbody").append(`
              <tr>
                <td scope="row">${lead.id}</td>
                <td>${lead.first_name}</td>
                <td>${lead.last_name}</td>
                <td>${lead.phone_work}</td>
              </tr>
            `);

            // refresh the table
            editableTable.refresh({
              // editableColumns: "1,2,3",
              // onEdit: handleEdit,
              // onDelete: handleDelete,
            });

            // remove the spinner
            $(".spinner").remove();
          });
        },
      });
    </script>

    <!-- <script>
      $(document).ready(function () {
        generateRows(this);
        editLogic(this);
      });

      function generateRows(s) {
        const tr = $("tr")[1];
        $("tr")[1].remove();
        console.log(tr);
        for (let i = 0; i < 5; i++) {
          document.getElementByTagName("tbody").appendChild(tr);
        }
      }

      function editLogic(s) {
        const editBtns = $(".edit-btn");

        editBtns.on("click", function () {
          console.log(s.innerText);

          const isEditing = s.innerText == "Edit";

          if (isEditing) {
            save(s);
          } else {
            edit(s);
          }

          const id = s.id.split("-")[0];
          $(`.${id}`).attr("contenteditable", isEditing);
          $(`.${id}`).css("color", isEditing ? "blue" : "black");
        });
      }

      function edit(s) {
        s.innerText = "Edit";
        const id = s.id.split("-")[0];
      }

      function save(s) {
        s.innerText = "Save";
        console.log(s);
      }
    </script> -->
  </body>
</html>
